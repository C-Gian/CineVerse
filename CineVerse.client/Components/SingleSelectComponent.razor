@typeparam TItem
@typeparam TValue

<div class="select-dropdown" @onclick:stopPropagation>
    <div class="select-toggle"
         @onpointerdown="TogglePointer"
         @onpointerdown:stopPropagation="true">
        <span class="multiselect-label">@DisplayText</span>
        <span class="multiselect-count">@SelectedValue</span>
        <span class="multiselect-arrow @(IsOpen ? "up" : null)">▾</span>
    </div>

    <div class="select-menu @(IsOpen ? "show" : "hide")"
         tabindex="-1"
         @onfocusout="LostFocus"
         @onfocusin="GainedFocus">
        @if (Searchable)
        {
            <input class="select-search"
                   placeholder="Search…"
                   @bind="SearchTerm"
                   @bind:event="oninput"
                   @ref="MenuRef" />
        }

        <div class="select-options">
            @foreach (var opt in Filtered)
            {
                var key = ValueSelector(opt);
                <label class="select-item">
                    <input type="radio" name="single"
                           checked="@Equals(SelectedValue, key)"
                           @onchange="@(() => Pick(key))" />
                    <span>@TextSelector(opt)</span>
                </label>
            }
        </div>
    </div>
</div>


<style>
    .select-dropdown {
        min-width: 180px;
        position: relative;
        font-family: inherit;
        height: 42px;
    }

    .select-toggle {
        display: flex;
        align-items: center;
        background: rgba(255,255,255,0.06);
        border-radius: 8px;
        padding: 0.5rem 1rem;
        cursor: pointer;
        color: #fff;
        height: 100%;
        gap: 0.5rem;
    }

    .select-arrow {
        font-size: 1.5rem;
        line-height: 0;
        opacity: .6;
        transition: transform .25s
    }

        .select-arrow.up {
            transform: rotate(180deg)
        }

    .select-menu {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        display: flex;
        height: 450px;
        flex-direction: column;
        gap: 0.75rem;
        z-index: 9999;
        opacity: 0;
        transform: translateY(-10px);
        pointer-events: none;
        transition: opacity 0.15s ease, transform 0.25s ease;
        margin-top: 8px;
        background: #1a1d2b;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        padding: 0.5rem;
    }

        .select-menu.show {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        .select-menu.hide {
            opacity: 0;
            transform: translateY(-10px);
            pointer-events: none;
        }

    .select-search {
        width: 100%;
        margin-bottom: .5rem;
        padding: .4rem .6rem;
        border-radius: 6px;
        background: #242636;
        color: #fff;
        border: none;
        font-size: .9rem;
        outline: none
    }

    .select-options {
        max-height: 450px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 0.6rem;
        padding-right: 10px;
        box-sizing: content-box;
    }

    .select-item {
        display: flex;
        align-items: center;
        gap: .6rem;
        cursor: pointer;
        color: #ddd;
        font-size: .9rem;
        padding: .5rem .75rem;
        border-radius: 6px; 
        transition: background .15s ease,color .15s ease;
    }

        .select-item:hover {
            background: rgba(255,255,255,.10);
            color: #fff
        }

        .select-item input {
            display: none
        }

            .select-item input:checked + span {
                font-weight: 600;
                color: #fff
            }

</style>